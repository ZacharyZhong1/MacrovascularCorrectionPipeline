# Macrovascular Correction Pipeline
MRA-Informed Biophysical Simulation for Removing Macrovascular Effects from fMRI

This pipeline was developed for the following studies. Please read these papers—especially the first one—carefully before using the pipeline.
>1. Xiaole Z. Zhong, Jonathan R. Polimeni, J. Jean Chen; Predicting the macrovascular contribution to resting-state fMRI functional connectivity at 3 Tesla: A model-informed approach. Imaging Neuroscience 2024; 2 imag–2–00315. doi: https://doi.org/10.1162/imag_a_00315
>2. to be added...

This toolbox has four subunits. Please run them follow the order.

## Vessel_Segmentation
This step segments the vasculature from TOF-MRA using the BrainCharter toolbox. Please cite the original study if you use this component.
>Bernier, M., Cunnane, S. C., & Whittingstall, K. (2018). The morphology of the human cerebrovascular system. Human Brain Mapping. https://doi.org/10.1002/hbm.24337

extract_vessel.sh
  Function: Core vessel extraction function from the BrainCharter toolbox.

MRVExtract_Coronal.m / MRVExtract_Sagittal.m
  Function: Registers MRA to T1 space and executes the main loop that calls the primary bash script. (For our dataset, both coronal and sagittal scans were used to improve vascular completeness.)
  Input: ParticipantFolder.txt — a text file listing input file names, one per line.

MRV_Enhance.m
  Function: Combines segmented vascular maps from coronal and sagittal MRA scans. (Automatically processes all segmented files generated by the previous script.)
